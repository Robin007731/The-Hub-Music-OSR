<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Hub Music - Cliente</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;800;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1DB954; --bg: #000; --card: #121212; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; padding-bottom: 100px; }
        .container { padding: 20px; max-width: 500px; margin: auto; }
        input { width: 100%; background: #282828; border: none; padding: 15px; border-radius: 10px; color: white; margin-bottom: 15px; box-sizing: border-box; }
        .btn-send { background: var(--primary); color: black; border: none; padding: 18px; border-radius: 50px; width: 100%; font-weight: 900; cursor: pointer; }
        
        /* RESULTADOS Y FILA */
        .list-item { display: flex; align-items: center; background: var(--card); padding: 10px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #222; }
        .list-item img { width: 50px; height: 50px; border-radius: 8px; margin-right: 12px; }
        .list-info b { color: var(--primary); font-size: 12px; display: block; }
        .list-info span { font-size: 11px; }

        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; padding: 15px; }
        .nav-btn { background: none; border: none; color: #555; font-size: 10px; font-weight: 800; cursor: pointer; }
        .active-nav { color: var(--primary); }

        /* MODAL Y CRÃ‰DITOS */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; }
        .footer { position: fixed; bottom: 70px; width: 100%; text-align: center; }
        .terms-btn { color: #444; font-size: 10px; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container">
        <div id="p-pedir">
            <h2 style="color:var(--primary)">PEDIR MÃšSICA</h2>
            <input type="text" id="user" placeholder="Tu Nombre">
            <input type="text" id="search" placeholder="Buscar canciÃ³n..." oninput="searchYT()">
            <div id="results"></div>
            <div id="preview" style="display:none; margin-bottom:15px; text-align:center;">
                <img id="pre-img" src="" style="width:100%; border-radius:10px;">
                <p id="pre-title" style="font-size:12px;"></p>
                <button class="btn-send" onclick="send()">ENVIAR A ADMIN ðŸš€</button>
            </div>
        </div>

        <div id="p-lista" style="display:none;">
            <h2 style="color:var(--primary)">FILA ACTUAL</h2>
            <div id="queue"></div>
        </div>
    </div>

    <div class="footer">
        <p style="font-size: 9px; color: #333; margin: 0;">Created by Robinson Chagas</p>
        <span class="terms-btn" onclick="document.getElementById('m').style.display='block'">TÃ©rminos y Condiciones</span>
    </div>

    <div id="m" class="modal" onclick="this.style.display='none'">
        <div style="background:#121212; margin: 30% auto; padding: 30px; width: 80%; border-radius: 20px;">
            <h3>TÃ©rminos OSR</h3>
            <p style="font-size:12px; color:#666;">Sistema de uso compartido. La mÃºsica ofensiva serÃ¡ eliminada por el administrador.</p>
        </div>
    </div>

    <nav class="nav-bar">
        <button class="nav-btn active-nav" onclick="tab('pedir')">PEDIR</button>
        <button class="nav-btn" onclick="tab('lista')">FILA</button>
    </nav>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        firebase.initializeApp({
            apiKey: "AIzaSyCk4wgJ2LPicyWnO8XXPQxqu49dtqM8jz4",
            databaseURL: "https://the-hub-music-osr-default-rtdb.firebaseio.com"
        });
        const db = firebase.database();
        let selected = null;

        function tab(t) {
            document.getElementById('p-pedir').style.display = t=='pedir'?'block':'none';
            document.getElementById('p-lista').style.display = t=='lista'?'block':'none';
            if(t=='lista') syncQueue();
        }

        async function searchYT() {
            const q = document.getElementById('search').value;
            if(q.length < 3) return;
            const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=3&q=${q}&type=video&key=AIzaSyBiRDaFPzpNrmg_SHvAZqtBsGXqHXkgK5k`);
            const data = await res.json();
            const resDiv = document.getElementById('results');
            resDiv.innerHTML = "";
            data.items.forEach(i => {
                const d = document.createElement('div');
                d.className = 'list-item';
                d.innerHTML = `<img src="${i.snippet.thumbnails.default.url}"><span>${i.snippet.title}</span>`;
                d.onclick = () => {
                    selected = {id: i.id.videoId, title: i.snippet.title};
                    document.getElementById('pre-img').src = i.snippet.thumbnails.high.url;
                    document.getElementById('pre-title').innerText = i.snippet.title;
                    document.getElementById('preview').style.display = 'block';
                    resDiv.innerHTML = "";
                };
                resDiv.appendChild(d);
            });
        }

        function send() {
            const u = document.getElementById('user').value;
            if(!u || !selected) return alert("Pon tu nombre");
            db.ref('osr_lista').push({ user: u, id: selected.id, title: selected.title, estado: null });
            alert("Â¡Enviado!");
            location.reload();
        }

        function syncQueue() {
            db.ref('osr_lista').on('value', (snap) => {
                const qDiv = document.getElementById('queue');
                qDiv.innerHTML = "";
                snap.forEach(c => {
                    const d = c.val();
                    if(!d.estado) {
                        qDiv.insertAdjacentHTML('beforeend', `<div class="list-item"><img src="https://img.youtube.com/vi/${d.id}/mqdefault.jpg"><div class="list-info"><b>${d.user}</b><span>${d.title}</span></div></div>`);
                    }
                });
            });
        }
    </script>
</body>
</html>
